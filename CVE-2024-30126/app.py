from flask import Flask, render_template_string, request

app = Flask(__name__)

# -------------------- VULNERABLE VERSION --------------------
@app.route('/vuln')
def vuln_home():
    html = """
    <!DOCTYPE html>
    <html>
    <head><title>Vulnerable Dashboard</title></head>
    <body>
        <h1>[Vulnerable] Welcome to the Dashboard</h1>
        <p><a href='/vuln/settings'>Go to Settings</a></p>
    </body>
    </html>
    """
    return render_template_string(html)

@app.route('/vuln/settings')
def vuln_settings():
    html = """
    <!DOCTYPE html>
    <html>
    <head><title>Settings</title></head>
    <body>
        <h1>[Vulnerable] Settings Page</h1>
        <form>
            <label><input type='checkbox' checked> Enable Notifications</label><br>
            <label><input type='checkbox'> Auto Updates</label><br><br>
            <button>Submit</button>
        </form>
    </body>
    </html>
    """
    return render_template_string(html)


# -------------------- SECURE VERSION --------------------
@app.after_request
def add_security_headers(response):
    # Only apply X-Frame-Options to /secure and its subroutes
    if request.path.startswith("/secure"):
        response.headers['X-Frame-Options'] = 'DENY'
    return response

@app.route('/secure')
def secure_home():
    html = """
    <!DOCTYPE html>
    <html>
    <head><title>Secure Dashboard</title></head>
    <body>
        <h1>[Secure] Welcome to the Dashboard</h1>
        <p><a href='/secure/settings'>Go to Settings</a></p>
    </body>
    </html>
    """
    return render_template_string(html)

@app.route('/secure/settings')
def secure_settings():
    html = """
    <!DOCTYPE html>
    <html>
    <head><title>Settings</title></head>
    <body>
        <h1>[Secure] Settings Page</h1>
        <form>
            <label><input type='checkbox' checked> Enable Notifications</label><br>
            <label><input type='checkbox'> Auto Updates</label><br><br>
            <button>Submit</button>
        </form>
    </body>
    </html>
    """
    return render_template_string(html)


if __name__ == '__main__':
    app.run(debug=True)
