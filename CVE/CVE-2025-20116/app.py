from flask import Flask, render_template, request, redirect
import sqlite3

app = Flask(__name__)

def init_db():
     with sqlite3.connect('notes.db') as conn:
          conn.execute('''
          CREATE TABLE IF NOT EXISTS notes (
               id INTEGER PRIMARY KEY AUTOINCREMENT,
               content TEXT NOT NULL
          )
          ''')

init_db()

@app.route("/")
def index():
     with sqlite3.connect('notes.db') as conn:
          cursor = conn.execute('SELECT id, content FROM notes')
          notes = cursor.fetchall()
     return render_template("index.html", notes=notes)

@app.route("/add", methods=["GET","POST"])
def add_note():
     if request.method == "POST":
          content = request.form["content"]
          with sqlite3.connect('notes.db') as conn:
               conn.execute('INSERT INTO notes (content) VALUES (?)', (content,))
          return redirect("/")
     return render_template("add.html")

if __name__ == "__main__":
     app.run(debug=True)