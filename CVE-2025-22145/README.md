# Flask Locale Vulnerability (CVE-2025-22145 Inspired)

This is a simple Flask web application that demonstrates a **vulnerable locale handling system**, similar to **CVE-2025-22145** (Carbon PHP library vulnerability). The app allows users to select a locale, which directly affects the behavior of the application. However, this version contains an **insecure implementation** of dynamic imports based on user input, which can lead to **Remote Code Execution (RCE)**.

## 🚨 Vulnerability Overview

In this example, the Flask app allows users to provide input to choose a locale. The input is directly used to dynamically import Python files, without proper sanitization. This means that a malicious user could exploit this to execute arbitrary code on the server by providing a specially crafted locale value.

For example, uploading a malicious Python file like `evil.py` containing a payload (e.g., running shell commands) could allow an attacker to execute code on the server.

### ⚠️ Potential Exploit

The attacker could upload a file named `evil.py` with malicious code, then set the `locale` query parameter to `evil`, causing the server to import and execute the malicious code.

Example payload in the `evil.py` file:
```python
def greet():
    import os
    os.system("calc")  # Opens calculator on Windows
    return "Hacked!"
```

## 🛠 Features

- Dynamically set the locale by using user input (`/` route).
- Renders a message based on the chosen locale.
- Vulnerable to **Remote Code Execution (RCE)** through unsanitized user input in locale selection.

## 💡 How to Run

```bash
# Clone the repository
git clone https://github.com/yourname/flask-locale-vuln.git
cd flask-locale-vuln

# Create a virtual environment (optional)
python -m venv venv
source venv/bin/activate   # On Windows: venv\Scripts\activate

# Install Flask
pip install Flask

# Run the app
python app.py
```

Access the app in your browser: [http://127.0.0.1:5000](http://127.0.0.1:5000).

## 🛡️ How to Fix

1. **Whitelist Allowed Locales**: Ensure only valid locales are allowed by checking against a list of approved locales.
2. **Sanitize User Input**: Always validate and sanitize user input before using it in dynamic operations (like importing files).

## 📁 File Structure

```
.
├── app.py               # Main Flask application
├── templates/
│   └── index.html       # HTML template for rendering messages
└── locales/
    ├── en.py            # English locale
    ├── fr.py            # French locale
    └── evil.py          # Malicious locale file (for exploitation)
```

## 🔐 Mitigation Example

The following changes should be made to the app to prevent the vulnerability:

1. **Sanitize the Locale Input**:

```python
allowed_locales = {"en", "fr"}

if locale in allowed_locales:
    locale_module = importlib.import_module(f"locales.{locale}")
else:
    raise ValueError("Invalid locale selected.")
```

## 📜 References

- [CVE-2025-22145 - Carbon PHP Vulnerability](https://nvd.nist.gov/vuln/detail/CVE-2025-22145)
- [Flask Documentation](https://flask.palletsprojects.com/)

## 🧑‍💻 Author

Made for educational purposes by [Your Name]
